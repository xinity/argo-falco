falco:
    falcosidekick:
        enabled: true
        webui:
            enabled: true
        config:
            webhook:
                address: http://webhook-falco-eventsource-svc.argo-events.svc.cluster.local:12000/falco
                customHeaders: Source:falco
    fakeEventGenerator:
      enabled: false
    falco:
      rulesFile:
        - /etc/falco/falco_rules.yaml
        - /etc/falco/falco_rules.local.yaml
        - /etc/falco/k8s_audit_rules.yaml
        - /etc/falco/rules.d/custom-rules.yaml
    customRules:
      custom-rules.yaml: |-
        - rule: COOKIE tampering detector
          desc: Detect tampering of super precious cookie recipes
          condition: modify and (evt.arg.oldpath startswith '/usr/share/nginx' or evt.arg.path startswith '/usr/share/nginx')
          output: Cookie recipes tampering detected, secure your cookies,(uid=%user.uid container_id=%container.id container_name=%container.name image=%container.image.repository:%container.image.tag %evt.arg.oldpath)
          priority: EMERGENCY
          tags: [importantrecipesalert]
        - rule: Execution from /dev/shm
          desc: This rule detects file execution UPDATE SIGMA DEMO ARGOCD SIGMA SIGMA SIGMA from the /dev/shm directory, a common location for threat actors to stash their readable + writable + (sometimes) executable files.
          condition: evt.type=execve and evt.dir=< and ((proc.exe startswith '/dev/shm' or (proc.cwd startswith /dev/shm and proc.exe startswith ./ )) or (proc.name in (ash,zsh,bash,sh,fish) and proc.args contains "/dev/shm"))
          output: "File execution detected from /dev/shm (proc.cmdline=%proc.cmdline image=%container.image.repository)"
          priority: CRITICAL
          tags: [mitre_execution]
